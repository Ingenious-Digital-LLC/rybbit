"use strict";(()=>{(function(){let o="[rybbit-ad]",s=document.currentScript;if(!s){console.warn(o,"Could not find script tag");return}let u=s.getAttribute("src")||"",f=u.split("/ad.js")[0].replace("/api",""),l=s.getAttribute("data-site-id")||"";if(console.log(o,"Initialized",{siteId:l,analyticsHost:f,src:u}),!l){console.warn(o,"No data-site-id attribute found on script tag");return}let h=f+"/api/track";function m(e){let r="";try{r=new URL(e).hostname}catch{}let t={type:"ad_click",site_id:l,pathname:e,hostname:r,screenWidth:window.screen.width,screenHeight:window.screen.height,language:navigator.language,page_title:document.title,referrer:document.referrer};console.log(o,"Sending ad_click",t),fetch(h,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),keepalive:!0}).then(n=>n.ok?console.log(o,"Tracked OK",n.status):n.text().then(i=>console.error(o,"Track failed",n.status,i))).catch(n=>console.error(o,"fetch error:",n))}function L(e){if(e.src)return e.src;let r=e;for(;r;){let t=r.getAttribute("id")||"",n=r.getAttribute("data-ad-slot")||"",i=r.getAttribute("data-ad-client")||"";if(n)return`ad-slot:${n}`;if(i)return`ad-client:${i}`;if(t)return`container:${t}`;r=r.parentElement}return"unknown-ad"}document.addEventListener("click",function(e){let t=e.target.closest("a");if(!t)return;let n=t.querySelector("img");if(!n)return;let i=n.src;i&&(console.log(o,"Direct <a><img> click detected",i),m(i))});let c=null,a=null;function p(){c=this,console.debug(o,"Mouse entered iframe",this.src||"(no src)")}function E(){c===this&&(c=null)}function d(e){e.addEventListener("mouseenter",p),e.addEventListener("mouseleave",E)}function g(){let e=document.querySelectorAll("iframe");console.log(o,`Found ${e.length} iframes on page`),e.forEach(d)}new MutationObserver(function(e){for(let r of e)for(let t of Array.from(r.addedNodes))t instanceof HTMLIFrameElement&&(console.debug(o,"New iframe added",t.src||"(no src)"),d(t)),t instanceof HTMLElement&&t.querySelectorAll("iframe").forEach(d)}).observe(document.documentElement,{childList:!0,subtree:!0}),window.addEventListener("blur",function(){a&&clearTimeout(a),a=setTimeout(function(){if(c){let e=L(c);console.log(o,"Iframe click detected via blur",e),m(e),c=null}},100)}),window.addEventListener("focus",function(){a&&(clearTimeout(a),a=null)}),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",g):g()})();})();
